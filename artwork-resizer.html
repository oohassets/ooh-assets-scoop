<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Batch Video Converter</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f1f4f9;
    padding:30px;
}
.container{
    max-width:1200px;
    margin:auto;
}
h2{
    text-align:center;
    margin-bottom:20px;
}
.controls{
    background:#fff;
    padding:20px;
    margin-bottom:20px;
    display:grid;
    grid-template-columns: repeat(4, 1fr);
    gap:15px;
    border:1px solid #ddd;
}
.controls label{
    font-size:13px;
    display:block;
}
.controls input, .controls select{
    width:100%;
    padding:5px;
}
table{
    width:100%;
    border-collapse:collapse;
    background:#fff;
}
th, td{
    border:1px solid #ddd;
    padding:8px;
    font-size:13px;
    text-align:center;
}
th{
    background:#1e88e5;
    color:#fff;
}
.progress-bar{
    height:8px;
    background:#ccc;
}
.progress-fill{
    height:8px;
    width:0%;
    background:#1e88e5;
}
button{
    padding:10px 20px;
    margin-top:15px;
    cursor:pointer;
}
button:disabled{
    background:#ccc;
    cursor:not-allowed;
}
.status-processing{color:orange;}
.status-done{color:green;}
</style>
</head>
<body>

<div class="container">

<h2>Professional Batch Video Converter</h2>

<div class="controls">
<div>
<label>Width</label>
<input type="number" id="width" value="3670">
</div>

<div>
<label>Height</label>
<input type="number" id="height" value="247">
</div>

<div>
<label>Video Bitrate (kbps)</label>
<input type="number" id="bitrate" value="4000">
</div>

<div>
<label>Background</label>
<select id="bgColor">
<option value="black">Black</option>
<option value="white">White</option>
<option value="blue">Blue</option>
</select>
</div>

<div>
<label>Audio</label>
<select id="audio">
<option value="copy">Keep Audio</option>
<option value="none">Remove Audio</option>
</select>
</div>

<div style="grid-column: span 3;">
<label>Select Videos</label>
<input type="file" id="fileInput" accept="video/*" multiple>
</div>

</div>

<table>
<thead>
<tr>
<th>Name</th>
<th>Resolution</th>
<th>Duration</th>
<th>Orig Size (MB)</th>
<th>New Size (MB)</th>
<th>Status</th>
</tr>
</thead>
<tbody id="resultBody"></tbody>
</table>

<button id="downloadBtn" disabled>Download All</button>

</div>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: false });

const fileInput = document.getElementById("fileInput");
const resultBody = document.getElementById("resultBody");
const downloadBtn = document.getElementById("downloadBtn");

let convertedFiles = [];

fileInput.addEventListener("change", async (e)=>{

    const files = e.target.files;
    if(!files.length) return;

    resultBody.innerHTML="";
    convertedFiles=[];
    downloadBtn.disabled=true;

    if(!ffmpeg.isLoaded()){
        await ffmpeg.load();
    }

    const width=document.getElementById("width").value;
    const height=document.getElementById("height").value;
    const bitrate=document.getElementById("bitrate").value;
    const bg=document.getElementById("bgColor").value;
    const audioOpt=document.getElementById("audio").value;

    for(let file of files){

        if(!file.type.startsWith("video/")) continue;

        const videoURL=URL.createObjectURL(file);
        const video=document.createElement("video");
        video.src=videoURL;

        await new Promise(res=>video.onloadedmetadata=res);

        const row=document.createElement("tr");
        row.innerHTML=`
        <td>${file.name}</td>
        <td>${video.videoWidth}x${video.videoHeight}</td>
        <td>${video.duration.toFixed(2)}s</td>
        <td>${(file.size/1024/1024).toFixed(2)}</td>
        <td>-</td>
        <td class="status-processing">Processing...</td>
        `;
        resultBody.appendChild(row);

        const inputName=file.name;
        const outputName="converted_"+width+"x"+height+"_"+file.name;

        ffmpeg.FS("writeFile",inputName,await fetchFile(file));

        ffmpeg.setProgress(({ratio})=>{
            row.cells[5].innerHTML=
            `<div class="progress-bar">
               <div class="progress-fill" style="width:${Math.round(ratio*100)}%"></div>
             </div>`;
        });

        let vf=`scale=${width}:${height}:force_original_aspect_ratio=decrease,pad=${width}:${height}:(ow-iw)/2:(oh-ih)/2:${bg}`;

        let args=[
            "-i",inputName,
            "-vf",vf,
            "-b:v",bitrate+"k",
            "-preset","ultrafast"
        ];

        if(audioOpt==="none"){
            args.push("-an");
        }else{
            args.push("-c:a","copy");
        }

        args.push(outputName);

        await ffmpeg.run(...args);

        const data=ffmpeg.FS("readFile",outputName);

        convertedFiles.push({
            name:outputName,
            data:data
        });

        row.cells[4].innerText=(data.length/1024/1024).toFixed(2);
        row.cells[5].innerHTML=`<span class="status-done">Done</span>`;
    }

    if(convertedFiles.length>0){
        downloadBtn.disabled=false;
    }

});

downloadBtn.addEventListener("click",async()=>{
    const zip=new JSZip();
    convertedFiles.forEach(file=>{
        zip.file(file.name,file.data);
    });
    const content=await zip.generateAsync({type:"blob"});
    const link=document.createElement("a");
    link.href=URL.createObjectURL(content);
    link.download="converted_batch.zip";
    link.click();
});
</script>

</body>
</html>