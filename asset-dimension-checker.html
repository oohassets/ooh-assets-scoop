<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Artwork Dimension Checker</title>


<link rel="icon" href="images/scooplogo_black_192x192.png">

<style>
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    margin: 20px;
    background: #f5f5f5;
    color: #333;
}

.header {
    display: grid;
    grid-template-columns: 180px 1fr 180px 1fr;
    gap: 40px;
    align-items: center;
    margin-bottom: 20px;
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.08);
}

.header label {
    font-weight: bold;
}

.header input[type="text"] {
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 6px;
    cursor: pointer;
    width: auto;
}

.header button {
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: bold;
    transition: 0.3s;
    font-size: 14px;
}

#scanBtn {
    background: linear-gradient(135deg, #ff9f50, #e26b20);
}

#scanBtn:hover {
    opacity: 0.9;
}

#downloadBtn {
    background: linear-gradient(135deg, #ff9f50, #e26b20);
    padding: 10px 20px;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: bold;
    transition: 0.3s;
    font-size: 14px;
}

#downloadBtn:hover {
    opacity: 0.9;
}

.tables {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

/* Modern table styling */
table {
    border-collapse: collapse;
    width: 100%;
    font-size: 13px;
    background: #fff;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    table-layout: auto;
}

thead th {
    background: #444;
    color: #fff;
    font-weight: bold;
    padding: 10px;
    text-align: left;
}

tbody td {
    padding: 8px 10px;
    border-bottom: 1px solid #eee;
}

tbody tr:hover {
    background: #f0f8ff;
}

.bad {
    background: #ffc8c8 !important;
    color: #900;
}

tfoot th {
    background: #f0f0f0;
    font-weight: bold;
    text-align: left;
    padding: 8px 10px;
}

.total {
    margin-top: 12px;
    font-weight: bold;
    font-size: 14px;
    padding: 8px 10px;
}

#pathDisplay {
    background-color: #fafafa;
}

#pathDisplay:hover {
    border-color: #ff9f50;
}

@media (max-width: 900px) {
    .header {
        grid-template-columns: 1fr;
        gap: 10px;
    }
    .header label, .header input, .header button {
        width: 100%;
    }

    .tables {
        grid-template-columns: 1fr;
    }

    #downloadBtn {
        width: 100%;
    }
}

@media (max-width: 480px) {

    .header {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .tables {
        grid-template-columns: 1fr;
        gap: 10px;
    }

    .header input,
    .header button,
    #downloadBtn {
        width: 100%;
    }
}


</style>
</head>
<body>

<div class="header">
    <label for="abbr">Abbreviation Name</label>
    <input type="text" id="abbr" placeholder="Write Abbreviation Name" />

    <label for="folderPicker">Artwork Path</label>
    <input type="text" id="pathDisplay" readonly placeholder="Click to browse folder" />

    <input type="file" id="folderPicker" webkitdirectory multiple hidden />
</div>


<div class="tables">

<!-- LEFT TABLE -->
<div>
<table id="dimensionTable">
<thead>
<tr><th>Asset</th><th>Dimension</th><th>Count</th></tr>
</thead>
<tbody>
<tr><td>Underpass</td><td>6240X420</td><td>-</td></tr>
<tr><td>UDC Tower</td><td>6656X1040</td><td>-</td></tr>
<tr><td>QQ</td><td>3742X432</td><td>-</td></tr>
<tr><td>Digital Mupi</td><td>256X384</td><td>-</td></tr>
<tr><td>Monoprix</td><td>1080X1920</td><td>-</td></tr>
<tr><td>Gewan Crystal Walk</td><td>512X640</td><td>-</td></tr>
<tr><td>Gewan Crystal Walk</td><td>384X640</td><td>-</td></tr>
<tr><td>Gewan Crystal Walk</td><td>640X384</td><td>-</td></tr>
<tr><td>Gewan Crystal Walk</td><td>384X512</td><td>-</td></tr>
<tr><td>Gewan Crystal Walk</td><td>640X640</td><td>-</td></tr>
<tr><td>Gewan Building</td><td>1296X756</td><td>-</td></tr>
</tbody>
<tfoot>
<tr><th colspan="2">Total</th><th id="leftTotal">0</th></tr>
</tfoot>
</table>

<div class="total">
Total Count Wrong Dimension:
<span id="wrongCount">0</span>
</div>
</div>

<!-- RIGHT TABLE -->
<div>
<table id="resultTable">
<thead>
<tr>
<th>Artwork Name</th>
<th>Actual Dimension</th>
<th>Duration</th>
<th>Artwork Rename</th>
</tr>
</thead>
<tbody></tbody>
</table>

<button id="downloadBtn" style="margin-top:10px">Download Renamed Files</button>
</div>

</div>
<div id="progressContainer" style="margin-top:15px; display:none;">
    <div style="background:#ddd;border-radius:6px;overflow:hidden;height:20px;">
        <div id="progressBar" style="height:100%;width:0%;background:linear-gradient(135deg,#ff9f50,#e26b20);transition:0.3s;"></div>
    </div>
    <div id="progressText" style="margin-top:5px;font-size:13px;font-weight:bold;">
        0%
    </div>
    <div id="downloadNote" style="margin-top:5px;font-size:11px;color:#555;display:none;">
        Note: Please right-click the downloaded ZIP file, select Properties, check Unblock, and click Apply before extracting.
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<script>
const allowedDimensions = [
    "6240X420","6656X1040","3742X432","256X384",
    "1080X1920","512X640","384X640","640X384",
    "384X512","640X512","1296X756","640X640"
];

const folderPicker = document.getElementById("folderPicker");
const pathDisplay = document.getElementById("pathDisplay");

const downloadBtn = document.getElementById("downloadBtn");

pathDisplay.onclick = () => folderPicker.click();

folderPicker.onchange = async () => {
    const files = [...folderPicker.files];
    pathDisplay.value = files[0]?.webkitRelativePath.split("/")[0] || "";

    const abbr = document.getElementById("abbr").value.trim();
    const resultBody = document.querySelector("#resultTable tbody");
    resultBody.innerHTML = "";

    let wrong = 0;

    const dimensionCounts = {
        "6240X420":0,"6656X1040":0,"3742X432":0,"256X384":0,
        "1080X1920":0,"512X640":0,"384X640":0,"640X384":0,
        "384X512":0,"640X512":0,"1296X756":0,"640X640":0
    };

    const nameCounters = {}; // <-- NEW (for _1, _2, _3 logic)

    for (const file of files) {
        let w = 0, h = 0, duration = "";

        if (file.type.startsWith("image/")) {
            const img = await loadImage(file);
            w = img.width;
            h = img.height;
        }

        if (file.type.startsWith("video/")) {
            const meta = await loadVideo(file);
            w = meta.videoWidth;
            h = meta.videoHeight;
            duration = formatMMSS(meta.duration);
        }

        if (!w || !h) {
            const m = file.name.match(/(\d{2,5})\s*[xX]\s*(\d{2,5})/);
            if (m) { w = +m[1]; h = +m[2]; }
        }

        const dimText = (w && h) ? `${w}X${h}` : "N/A";
        const valid = allowedDimensions.includes(dimText);

        if (!valid) wrong++;

        if(dimensionCounts[dimText] !== undefined) dimensionCounts[dimText]++;

        // ðŸ”¹ Generate rename preview with _1, _2, _3
        let renamePreview = "";
        if (valid && abbr) {
            const baseKey = `${abbr}-${dimText}`;
            nameCounters[baseKey] = (nameCounters[baseKey] || 0) + 1;
            renamePreview = `${baseKey}_${nameCounters[baseKey]}`;
        }

        addResultRow(file.name, dimText, duration, valid, renamePreview);
    }

    // Update left table
    const dimTbody = document.querySelector("#dimensionTable tbody");
    let totalCount = 0;
    for (const row of dimTbody.rows) {
        const dim = row.cells[1].textContent;
        const count = dimensionCounts[dim] || 0;
        row.cells[2].textContent = count > 0 ? count : "-";
        totalCount += count;
    }

    document.getElementById("leftTotal").textContent = totalCount;
    document.getElementById("wrongCount").textContent = wrong;
};


function addResultRow(name, dim, dur, valid, renamePreview = "") {
    const tbody = document.querySelector("#resultTable tbody");
    const tr = document.createElement("tr");

    tr.innerHTML = `
        <td>${name}</td>
        <td class="${valid ? "" : "bad"}">${dim}</td>
        <td>${dur}</td>
        <td>
            ${valid && renamePreview 
                ? renamePreview 
                : '<span style="color:red;font-weight:bold;">âœ–</span> Skipped'}
        </td>
    `;

    tbody.appendChild(tr);
}


function loadImage(file) {
    return new Promise(res => {
        const img = new Image();
        img.onload = () => res(img);
        img.src = URL.createObjectURL(file);
    });
}

function loadVideo(file) {
    return new Promise(res => {
        const v = document.createElement("video");
        v.onloadedmetadata = () => res(v);
        v.src = URL.createObjectURL(file);
    });
}

function formatMMSS(sec) {
    if (!sec) return "";
    sec = Math.floor(sec);
    return String(Math.floor(sec / 60)).padStart(2, "0") +
           ":" + String(sec % 60).padStart(2, "0");
}

downloadBtn.onclick = async () => {
    const abbr = document.getElementById("abbr").value.trim();
    if (!abbr) {
        alert("Please enter an artwork abbreviation first.");
        return;
    }

    const tbody = document.querySelector("#resultTable tbody");
    if (!tbody.rows.length) {
        alert("No files to rename. Scan first.");
        return;
    }

    downloadBtn.disabled = true;

    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");

    progressContainer.style.display = "block";
    progressBar.style.width = "0%";
    progressText.textContent = "0%";

    const zip = new JSZip();
    const files = [...folderPicker.files];
    const usedNames = new Set();

    let validRows = [];
    for (const row of tbody.rows) {
        const dim = row.cells[1].textContent;
        if (allowedDimensions.includes(dim)) {
            validRows.push(row);
        }
    }

    if (validRows.length === 0) {
        alert("No valid artworks found to download.");
        downloadBtn.disabled = false;
        progressContainer.style.display = "none";
        return;
    }

    let processed = 0;

    for (const row of tbody.rows) {
        const originalName = row.cells[0].textContent;
        const dim = row.cells[1].textContent;
        const renameCell = row.cells[3];

        const isValid = allowedDimensions.includes(dim);

        if (!isValid) {
            renameCell.innerHTML = `
                <span style="color:red;font-weight:bold;">âœ–</span>
                Skipped
            `;
            continue;
        }

        const file = files.find(f => f.name === originalName);
        if (!file) continue;

        const ext = originalName.split('.').pop();

        // âœ… USE PREVIEW NAME (already _1 _2 _3)
        const previewName = renameCell.textContent.trim();
        const newName = previewName + "." + ext;

        if (usedNames.has(newName)) continue;
        usedNames.add(newName);

        renameCell.innerHTML = `
            <span style="color:green;font-weight:bold;">âœ”</span>
            ${newName}
        `;

        const fileData = await file.arrayBuffer();
        zip.file(newName, fileData);

        processed++;
        const percent = Math.round((processed / validRows.length) * 100);
        progressBar.style.width = percent + "%";
        progressText.textContent = percent + "%";
    }

    const content = await zip.generateAsync({ type: "blob" });

    const a = document.createElement("a");
    a.href = URL.createObjectURL(content);
    a.download = `${abbr}_Artworks.zip`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);

    progressText.textContent = "Download Complete âœ”";
    document.getElementById("downloadNote").style.display = "block";
    downloadBtn.disabled = false;
};
</script>

</body>
</html>
