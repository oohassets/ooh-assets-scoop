<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SCOOP OOH Assets</title>

<!-- PWA Icons -->
<link rel="icon" type="image/x-icon" href="https://oohassets.github.io/ooh-assets-scoop/icons/scoop_32x32.ico">
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#ffffff">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>

<style>
:root {
  --max-width: 1200px;
  --brand: #1f6feb;
  --brand-hover: #0056b3;
  --text: #36454F;
}
body { font-family: system-ui, sans-serif; margin:0; padding:1rem; color:var(--text); display:flex; justify-content:center; align-items:center; min-height:100vh; background: linear-gradient(70deg,#b262b4,#e8aa6e,#c9f085,#90b0ec); background-size:240% 240%; animation:gradient-move 25s ease infinite; }
.container { width:100%; max-width:var(--max-width); position:relative; display:none; }
.title-container { display:flex; justify-content:center; margin-bottom:.25rem; }
.logo { height:120px; width:auto; }
.asset-links { display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; margin-bottom:1rem; }
.asset-links a { color:var(--text); font-weight:600; text-decoration:none; cursor:pointer; }
.asset-links a.active { color:#FF5F15; text-decoration:underline; }
.map-wrapper { position:relative; width:100%; aspect-ratio:16/9; min-height:300px; border-radius:10px; overflow:hidden; box-shadow:0 6px 18px rgba(20,20,40,0.08); background:#4d6a79; }
.map-wrapper iframe, .inventory-wrapper iframe { position:absolute; inset:0; width:100%; height:100%; border:0; }
.inventory-wrapper { display:none; width:100%; aspect-ratio:16/9; min-height:300px; border-radius:10px; overflow:hidden; box-shadow:0 6px 18px rgba(20,20,40,0.08); background:#e9eef6; margin-top:.75rem; }
.controls { display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.75rem; justify-content:center; }
.btn { flex:1 1 auto; background:var(--brand); color:#fff; border:none; padding:.5rem .75rem; border-radius:8px; font-weight:600; font-size:.9rem; cursor:pointer; text-align:center; text-decoration:none; }
.btn:hover { background:var(--brand-hover); }
.note { font-size:.75rem; color:#fff; margin-top:.5rem; text-align:left; }
.fullscreen-wrapper { width:100% !important; height:100% !important; border-radius:0 !important; box-shadow:none !important; margin:0 !important; }

@keyframes gradient-move { 0% { background-position:0% 50%; } 50% { background-position:100% 50%; } 100% { background-position:0% 50%; } }
</style>
</head>
<body>

<!-- Splash -->
<div id="splash-screen" style="position:fixed; inset:0; background:#000; display:flex; align-items:center; justify-content:center; z-index:99999;">
  <img id="splash-logo" src="https://oohassets.github.io/ooh-assets-scoop/icons/scoop_black_512x512.png" style="width:180px; height:180px; opacity:0; transform:scale(0.9); transition:opacity 1.5s, transform 1.5s;">
</div>

<!-- Login -->
<div id="login-screen" style="position:fixed; inset:0; display:flex; justify-content:center; align-items:center; flex-direction:column; background:linear-gradient(70deg,#b262b4,#e8aa6e,#c9f085,#90b0ec); z-index:9999; overflow:auto; padding:1rem;">
  <div style="background:rgba(255,255,255,0.95); padding:2rem; border-radius:16px; text-align:center; width:100%; max-width:340px; box-sizing:border-box;">
    <img src="https://raw.githubusercontent.com/oohassets/ooh-assets-scoop/main/scooplogo.png" alt="Logo" style="height:80px; margin-bottom:.5rem; width:auto;">
    <h3 style="color:#333; margin-bottom:.75rem;">Login to Continue</h3>
    <input type="text" id="username" placeholder="Username" style="width:100%; padding:.5rem 0; border:none; border-bottom:2px solid #ccc; margin-bottom:.9rem; outline:none;">
    <input type="password" id="password" placeholder="Password" style="width:100%; padding:.5rem 0; border:none; border-bottom:2px solid #ccc; margin-bottom:1.2rem; outline:none;">
    <button id="loginBtn" style="width:100%; background:#1f6feb; color:#fff; border:none; padding:.6rem; border-radius:6px; font-weight:600; cursor:pointer;">Login</button>
    <p id="loginMessage" style="margin-top:.6rem; color:#c00; font-size:.9rem;"></p>
  </div>
</div>

<!-- Main -->
<div class="container" id="mainContainer">
  <div class="title-container">
    <img src="https://raw.githubusercontent.com/oohassets/ooh-assets-scoop/main/scooplogo.png" class="logo">
  </div>

  <div class="asset-links" id="assetLinks">
    <a href="#" id="digitalLink" class="active" data-map="">Digital Screens</a>
    <a href="#" id="lightPolesLink" data-map="">Light Poles</a>
    <a href="#" id="staticMupiLink" data-map="">Static Mupi</a>
  </div>

  <div class="map-wrapper" id="mapWrapper">
    <iframe id="mapIframe" title="OOH Assets Map" loading="lazy"></iframe>
    <p class="note">Click toggle bar to select OOH Assets. Use <strong>Full screen</strong> to expand the map.</p>
  </div>

  <div class="controls">
    <button class="btn" id="fsBtn">Full screen</button>
    <button class="btn" id="showInventoryBtn">Show Content Inventory</button>
  </div>

  <div class="inventory-wrapper" id="inventoryWrapper">
    <iframe id="contentInventorySheet" title="Content Inventory"></iframe>
  </div>
</div>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCKH-qxF9rqJds8Oi69MA8zpoHB0BL_jlk",
  authDomain: "scoop-ooh-assets.firebaseapp.com",
  projectId: "scoop-ooh-assets",
  storageBucket: "scoop-ooh-assets.firebasestorage.com",
  messagingSenderId: "611605892213",
  appId: "1:611605892213:web:d71dc48fec993b80f6bc3c"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Convert to embed URLs
function toEmbedUrl(url) {
  if (!url) return "";
  if (url.includes("google.com/maps")) {
    if (!url.includes("/embed")) return url.replace("/place/", "/embed?") + "&output=embed";
    return url;
  }
  if (url.includes("docs.google.com/spreadsheets")) return url.replace("/edit", "/preview");
  return url;
}

// Load maps and sheet
function loadMaps() {
  db.collection("appLinks").doc("oohLinks").get()
    .then(doc => {
      if (!doc.exists) return console.error("No Firestore document found!");
      const data = doc.data();
      const container = document.getElementById("mainContainer");
      container.style.display = "block";

      // Iframes
      const mapIframe = document.getElementById("mapIframe");
      mapIframe.src = toEmbedUrl(data.mapLink_DigitalScreen);

      document.getElementById("digitalLink").dataset.map = toEmbedUrl(data.mapLink_DigitalScreen);
      document.getElementById("lightPolesLink").dataset.map = toEmbedUrl(data.mapLink_LightPoles);
      document.getElementById("staticMupiLink").dataset.map = toEmbedUrl(data.mapLink_StaticMupi);

      document.getElementById("contentInventorySheet").src = toEmbedUrl(data.sheetLink_ContentInventory);

      // Asset links
      document.querySelectorAll(".asset-links a").forEach(link => {
        link.addEventListener("click", e => {
          e.preventDefault();
          document.querySelectorAll(".asset-links a").forEach(l => l.classList.remove("active"));
          link.classList.add("active");
          mapIframe.src = link.dataset.map;
        });
      });
    })
    .catch(err => console.error("Firestore error:", err));
}

// Splash fade
window.addEventListener('load', () => {
  const splash = document.getElementById('splash-screen');
  const logo = document.getElementById('splash-logo');
  logo.style.opacity = 1; logo.style.transform = "scale(1)";
  setTimeout(() => { splash.remove(); checkLoginStatus(); }, 2500);
});

// Login
function checkLoginStatus() {
  const loggedUser = localStorage.getItem('loggedUser');
  if (loggedUser) { document.querySelector('.container').style.display='block'; loadMaps(); }
  else { document.getElementById('login-screen').style.display='flex'; }
}

document.getElementById('loginBtn').addEventListener('click', async () => {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const message = document.getElementById('loginMessage');
  if (!username || !password) { message.textContent = 'Please enter both fields.'; return; }

  try {
    const userCredential = await auth.signInWithEmailAndPassword(username, password);
    localStorage.setItem('loggedUser', userCredential.user.email);
    message.style.color='green'; message.textContent='Login successful!';
    setTimeout(() => { document.getElementById('login-screen').style.display='none'; loadMaps(); }, 800);
  } catch(e) { console.error(e); message.style.color='#c00'; message.textContent=e.message; }
});

// Logout
document.addEventListener('click', e => {
  if(e.target.id==='logoutText') {
    auth.signOut().then(() => {
      localStorage.removeItem('loggedUser');
      document.querySelector('.container').style.display='none';
      document.getElementById('login-screen').style.display='flex';
    });
  }
});

// Fullscreen
const fsBtn = document.getElementById('fsBtn');
const wrapper = document.getElementById('mapWrapper');
fsBtn.addEventListener('click', async () => {
  try { if(!document.fullscreenElement) await wrapper.requestFullscreen(); else await document.exitFullscreen(); } 
  catch(err){ console.warn(err); }
});

// Inventory toggle
const inventoryWrapper = document.getElementById('inventoryWrapper');
document.getElementById('showInventoryBtn').addEventListener('click', async () => {
  const isVisible = inventoryWrapper.style.display==="block";
  if(!isVisible){ inventoryWrapper.style.display="block"; try{await inventoryWrapper.requestFullscreen();}catch{} }
  else{ inventoryWrapper.style.display="none"; if(document.fullscreenElement) await document.exitFullscreen(); }
});
</script>

</body>
</html>
